
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ç«¶é¦¬ã‚²ãƒ¼ãƒ </title>

<style>
body {
  font-family: sans-serif;
  background:#eef;
}

#money {
  font-size:18px;
  margin-bottom:8px;
}

#track {
  position: relative;
  width: 800px;
  height: 400px;
  background: #4caf50;
  border: 6px solid #555;
  border-radius: 200px;
  margin-top:10px;
  overflow: hidden;
}

/* ã‚´ãƒ¼ãƒ«ãƒ©ã‚¤ãƒ³ */
#goal {
  position: absolute;
  right: 60px;
  top: 0;
  width: 6px;
  height: 100%;
  background: repeating-linear-gradient(
    white 0px,
    white 10px,
    black 10px,
    black 20px
  );
}

.horse {
  position: absolute;
  font-size: 14px;
  white-space: nowrap;
}
</style>
</head>

<body>

<h1>ğŸ‡ ç«¶é¦¬ã‚²ãƒ¼ãƒ ï¼ˆå³å›ã‚Šãƒ»èŠãƒ»2400mï¼‰</h1>

<div id="money">æ‰€æŒé‡‘ï¼š100000å††</div>

<div>
  è³­ã‘ã‚‹é¦¬ï¼š
  <select id="betHorse"></select>
  è³­ã‘é‡‘ï¼š
  <input type="number" id="betMoney" value="100" min="100">
  <button onclick="startRace()">ãƒ¬ãƒ¼ã‚¹é–‹å§‹</button>
</div>

<div id="odds"></div>

<div id="track">
  <div id="goal"></div>
</div>

<script>
const DISTANCE = 2400;
let money = 100000;
let racing = false;

// æ¥•å††è¨­å®š
const CENTER_X = 400;
const CENTER_Y = 200;
const RADIUS_X = 300;
const RADIUS_Y = 140;

const horses = [
  { id:0, name:"ã‚µã‚¯ãƒ©ãƒ©ã‚¤ãƒˆ", color:"red",    base:1.0 },
  { id:1, name:"ãƒ–ãƒ«ãƒ¼ã‚¦ã‚£ãƒ³ãƒ‰", color:"blue", base:0.95 },
  { id:2, name:"ã‚°ãƒªãƒ¼ãƒ³ãƒ•ãƒ©ãƒƒã‚·ãƒ¥", color:"green", base:1.05 },
  { id:3, name:"ã‚ªãƒ¬ãƒ³ã‚¸ã‚­ãƒ³ã‚°", color:"orange", base:0.9 },
  { id:4, name:"ãƒ‘ãƒ¼ãƒ—ãƒ«ã‚¹ã‚¿ãƒ¼", color:"purple", base:1.0 }
];

const track = document.getElementById("track");
const select = document.getElementById("betHorse");
const oddsDiv = document.getElementById("odds");

function setupRace(){
  track.querySelectorAll(".horse").forEach(h=>h.remove());
  select.innerHTML = "";
  oddsDiv.innerHTML = "<h3>ã‚ªãƒƒã‚º</h3>";

  horses.forEach((h,i)=>{
    // èª¿å­
    const r = Math.random();
    if(r < 0.3){ h.cond="ä¸èª¿"; h.rate=0.9; }
    else if(r < 0.7){ h.cond="æ™®é€š"; h.rate=1.0; }
    else { h.cond="å¥½èª¿"; h.rate=1.1; }

    h.pos = 0;

    h.odds = Math.max(1.2,(1/(h.base*h.rate))*3).toFixed(1);

    select.innerHTML +=
      `<option value="${h.id}">
        ${h.name}ï¼ˆ${h.cond} ${h.odds}å€ï¼‰
      </option>`;

    oddsDiv.innerHTML +=
      `${h.name}ï¼š${h.odds}å€ï¼ˆ${h.cond}ï¼‰<br>`;

    const el = document.createElement("div");
    el.className = "horse";
    el.style.color = h.color;
    el.textContent = "ğŸ " + h.name;
    track.appendChild(el);
    h.el = el;
  });
}

function updateMoney(){
  document.getElementById("money").textContent =
    "æ‰€æŒé‡‘ï¼š" + money + "å††";
}

function startRace(){
  if(racing) return;

  const bet = Number(select.value);
  const betMoney = Number(document.getElementById("betMoney").value);

  if(betMoney < 100 || betMoney > money){
    alert("è³­ã‘é‡‘ãŒä¸æ­£ã§ã™");
    return;
  }

  money -= betMoney;
  updateMoney();
  racing = true;

  const timer = setInterval(()=>{
    horses.forEach(h=>{
      h.pos += Math.random() * 25 * h.base * h.rate;

      // æ¥•å††ãƒˆãƒ©ãƒƒã‚¯è¨ˆç®—
      const angle = (h.pos / DISTANCE) * Math.PI * 2;
      const x = CENTER_X + Math.cos(angle) * RADIUS_X;
      const y = CENTER_Y + Math.sin(angle) * RADIUS_Y;

      h.el.style.left = x + "px";
      h.el.style.top = y + "px";
    });

    const finished = horses.find(h=>h.pos >= DISTANCE);
    if(finished){
      clearInterval(timer);
      racing = false;

      horses.sort((a,b)=>b.pos-a.pos);
      const winner = horses[0];

      if(winner.id === bet){
        const payout = Math.floor(betMoney * winner.odds);
        money += payout;
        alert(`ğŸ‰ çš„ä¸­ï¼ å‹è€…ï¼š${winner.name}\n+${payout}å††`);
      } else {
        alert(`ğŸ’€ ãƒã‚ºãƒ¬â€¦ å‹è€…ï¼š${winner.name}`);
      }

      updateMoney();
      setupRace();

      if(money <= 0){
        alert("GAME OVER");
      }
    }
  },100);
}

setupRace();
updateMoney();
</script>

</body>
</html>
