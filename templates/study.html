<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英単語学習</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background: #f0f2f5; }
        .card { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 80%; max-width: 400px; text-align: center; }
        .en { font-size: 2.5rem; font-weight: bold; margin-bottom: 1rem; }
        .jp { font-size: 1.2rem; color: #666; margin-bottom: 2rem; visibility: hidden; } /* クリックで表示する等のアレンジが可能 */
        .controls { display: flex; gap: 1rem; width: 80%; max-width: 400px; margin-top: 2rem; }
        button { flex: 1; padding: 1rem; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; color: white; transition: opacity 0.2s; }
        .btn-know { background-color: #4caf50; }
        .btn-dont-know { background-color: #f44336; }
        button:active { opacity: 0.7; }
    </style>
</head>
<body>

    <div id="app" class="card">
        <div id="word-en" class="en">読み込み中...</div>
        <div id="word-jp" class="jp">...</div>
        <div id="progress-text" style="font-size: 0.8rem; color: #999;"></div>
    </div>

    <div class="controls">
        <button class="btn-dont-know" onclick="handleResult('dont_know')">分からない</button>
        <button class="btn-know" onclick="handleResult('know')">分かる</button>
    </div>

    <script>
    let allWords = [];
    let currentIndex = 0;

    // 最初に一度だけ全データをロード
    async function initApp() {
        const res = await fetch('/api/get_all_data');
        const data = await res.json();
        allWords = data.words;
        currentIndex = data.current_index;
        renderWord();
    }

    // 画面の表示を更新する関数（通信しないので爆速）
    function renderWord() {
        if (currentIndex >= allWords.length) {
            document.getElementById('word-en').innerText = "完了！";
            document.getElementById('word-jp').innerText = "全ての単語をチェックしました";
            return;
        }

        const word = allWords[currentIndex];
        document.getElementById('word-en').innerText = word.en;
        //document.getElementById('word-jp').innerText = word.jp;
        document.getElementById('progress-text').innerText = `${currentIndex + 1} / ${allWords.length}`;
    }

    async function handleResult(status) {
        if (currentIndex >= allWords.length) return;

        const word = allWords[currentIndex];

        // 1. 保存処理は裏側で投げる（待たない）
        fetch('/api/submit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                status: status,
                word_id: word.id,
                current_index: currentIndex
            })
        });

        // 2. 即座に次の単語へ（ローカルの変数を増やすだけ）
        currentIndex++;
        renderWord();
    }

    // 起動
    initApp();
</script>
</body>
</html>
